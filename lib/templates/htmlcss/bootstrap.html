<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="bootstrap-nightshade.min.css">
    <script src="darkmode.min.js"></script>
    <script src="jquery-3.6.0.min.js"></script>
    <script>
        function init() {
            if (localStorage.getItem("user-theme") == null) {
                $mode = (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) ? 'dark' : 'light';

                if ($mode == 'dark') {
                    localStorage.setItem("user-theme", 'dark');
                } else {
                    localStorage.setItem("user-theme", 'light');
                }
            } else {
                $mode = (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) ? 'dark' : 'light';

                if ($mode == 'dark' && localStorage.getItem("user-theme") == 'dark') {
                    document.getElementById("flexSwitchCheckChecked").checked = true;
                    $("html").removeClass('light').addClass("dark");
                } else if ($mode == 'light' && localStorage.getItem("user-theme") == 'light') {
                    document.getElementById("flexSwitchCheckChecked").checked = false;
                    $("html").removeClass("dark").addClass('light');
                } else if ($mode == 'dark' && localStorage.getItem("user-theme") == 'light') {
                    document.getElementById("flexSwitchCheckChecked").checked = false;
                    $("html").removeClass("dark").addClass('light');
                } else if ($mode == 'light' && localStorage.getItem("user-theme") == 'dark') {
                    document.getElementById("flexSwitchCheckChecked").checked = true;
                    $("html").removeClass('light').addClass("dark");
                }
            }

            var json = {'fitting json': []};

            var index = 1;
            for (var key in json){
                console.log(index + "|" + key.split(" ")[0] + "|" + key.split(" ")[1] + " -> " + json[key]);

                var all_string = json[key].filter(element => {
                    return element !== null;
                });
                console.log(all_string);

                var covered_length = all_string.filter(x => x > 0).length
                console.log(covered_length);

                var not_covered_length = all_string.filter(x => x === 0).length
                console.log(not_covered_length);


                if (not_covered_length == 0) {
                    cover_percent = 100
                } else {
                    cover_percent = not_covered_length / all_string.length * 100
                }
                console.log(cover_percent);

                var myTable = document.getElementById('myTable').getElementsByTagName('tbody')[0];

                var row = myTable.insertRow();

            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            var cell5 = row.insertCell(4);
            var cell6 = row.insertCell(5);
            var cell7 = row.insertCell(6);
            var cell8 = row.insertCell(7);
            cell1.innerHTML = key.split(" ")[0];
            cell2.innerHTML = key.split(" ")[1];

            if (cover_percent == 100) {
                cell3.innerHTML = "<span class=\"badge rounded-pill bg-success\">"+ cover_percent +"%</span>";
            } else if (cover_percent >= 60) {
                cell3.innerHTML = "<span class=\"badge rounded-pill bg-warning\">" + cover_percent + "%</span>\n"
            } else {
                cell3.innerHTML = "<span class=\"badge rounded-pill bg-danger\">" + cover_percent + "%</span>\n"
            }
            cell4.innerHTML = "89";
            cell5.innerHTML = "19";
            cell6.innerHTML = "9";
            cell7.innerHTML = "10";
            cell8.innerHTML = "3.79";

                index += 1;
            }
        }

        function toggle_color_scheme_css() {
            if (localStorage.getItem("user-theme") == 'dark') {
                $("html").removeClass("dark").addClass('light');
                localStorage.setItem("user-theme", 'light');
            } else {
                $("html").removeClass('light').addClass("dark");
                localStorage.setItem("user-theme", 'dark');
            }
        }
    </script>
</head>
<body onload="init();">

<header class="bd-header bg-dark py-3 d-flex align-items-stretch border-bottom border-dark">
    <div class="container-fluid d-flex align-items-center">
        <h1 class="d-flex align-items-center fs-4 text-white mb-0">
            Fitting
        </h1>
        <!-- ***** ***** ***** THE BUTTON GOES HERE ***** ***** ***** -->
        <div class="btn-group ms-auto" role="group">
            <div class="mb-3 form-check form-switch">
                <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked"
                       onclick="toggle_color_scheme_css()">
            </div>
        </div>
        <!-- ***** ***** ***** THE BUTTON GOES HERE ***** ***** ***** -->
    </div>
</header>

<div class="bd-cheatsheet container-fluid">
        <table class="table table-striped" id="myTable">
            <thead>
            <tr>
                <th>METHOD</th>
                <th>URL</th>
                <th>% covered</th>
                <th>Lines</th>
                <th>Relevant Lines</th>
                <th>Lines covered</th>
                <th>Lines missed</th>
                <th>Avg. Hits / Line</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
</div>

</body>
</html>